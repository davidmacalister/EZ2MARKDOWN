<!doctype html>
<html lang="pt-BR">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title data-i18n-text="app.title">Source BR - HUB</title>
	<link rel="stylesheet" href="style.css" />
	<link rel="icon" type="image/png" href="icon.svg">
</head>
<body>
	<div id="app" class="theme-dark">
		<aside class="sidebar">
			<div class="logo">
				<img src="icon.svg" alt="Logo" style="height: 40px;">
			</div>
			<nav class="controls">
				<input id="folderInput" type="file" webkitdirectory directory multiple style="display:none" />
				<button id="openBtn" data-i18n-text="buttons.openFolder" title="Abrir pasta (Ctrl+O)">Abrir pasta</button>
				<button id="collapseBtn" data-i18n-text="buttons.collapseSidebar" title="Colapsar barra">‚á§</button>
			</nav>
			<div class="explorer">
				<div class="explorer-title" data-i18n-text="explorer.title">Explorer</div>
				<div class="explorer-search">
					<input
						id="explorerSearch"
						type="search"
						placeholder="Pesquisar arquivos..."
						aria-label="Pesquisar arquivos"
						data-i18n-placeholder="explorer.searchPlaceholder"
						data-i18n-aria-label="explorer.searchAriaLabel"
					/>
				</div>
				<ul id="fileList">
					<li class="empty" data-i18n-text="explorer.empty">Nenhum arquivo</li>
				</ul>
			</div>
		</aside>

		<!-- resizer: arraste para redimensionar a sidebar -->
		<div id="sidebarResizer" class="sidebar-resizer" role="separator" aria-orientation="vertical" aria-label="Redimensionar barra"></div>

		<main class="main">
			<header class="editor-header">
				<div class="tabs"><span id="currentFilename">untitled.md</span></div>
				<div class="header-actions">
					<!-- indicador de conex√£o: clic√°vel para tentar conectar/abrir seletor -->
						<div
							id="connStatus"
							class="conn-status"
							title="Status da conex√£o (clicar para conectar)"
							data-i18n-title="status.connectionTooltip"
						>
							<span class="dot"></span>
							<span class="label" data-i18n-text="status.disconnected">Desconectado</span>
						</div>
					<!-- bot√£o global para mostrar/ocultar editor bruto -->
					<button
						id="toggleRawBtn"
						title="Mostrar/Esconder editor bruto"
						data-i18n-title="buttons.toggleRaw"
					>üëÅ</button>
				</div>
			</header>

			<section class="preview-pane">
				<div
					id="preview"
					class="preview"
					title="Preview WYSIWYG ‚Äî arraste arquivos da barra lateral para inserir"
					data-i18n-title="preview.title"
				></div>
			</section>
		</main>
	</div>

	<!-- save progress (top fixed) -->
	<div
		id="saveProgress"
		class="save-progress hidden"
		aria-hidden="true"
	>
		<div
			class="save-progress-bar"
			role="progressbar"
			aria-valuemin="0"
			aria-valuemax="100"
		></div>
		<div class="save-progress-text" data-i18n-text="saveProgress.text">Salvando...</div>
	</div>

	<!-- connect prompt (show when Ctrl+S but not connected) -->
	<div
		id="connectPrompt"
		class="connect-prompt hidden"
		role="dialog"
		aria-modal="true"
		aria-hidden="true"
	>
		<div class="connect-prompt-content">
			<div class="cp-title" data-i18n-text="connectPrompt.title">Servidor local n√£o conectado</div>
			<div class="cp-body" data-i18n-text="connectPrompt.body">
				Para salvar no disco local voc√™ precisa conectar ao servidor local. Deseja conectar agora?
			</div>
			<div class="cp-actions">
				<button id="cpConnectBtn" data-i18n-text="connectPrompt.connect">Conectar</button>
				<button id="cpCancelBtn" data-i18n-text="connectPrompt.cancel">Cancelar</button>
			</div>
		</div>
	</div>

	<!-- painel raw (overlay) -->
	<div
		id="rawPanel"
		class="raw-panel hidden"
		role="dialog"
		aria-modal="true"
	>
		<div class="raw-panel-content">
			<div class="raw-panel-header">
				<span data-i18n-text="rawPanel.title">Editor ‚Äî texto bruto</span>
				<button
					id="rawClose"
					title="Fechar"
					data-i18n-title="buttons.close"
				>‚úï</button>
			</div>
			<textarea id="editor" spellcheck="false"></textarea>
			<div class="raw-panel-actions">
				<button id="rawCancel" data-i18n-text="rawPanel.cancel">Cancelar</button>
				<button id="rawApply" data-i18n-text="rawPanel.apply">Aplicar</button>
			</div>
		</div>
	</div>

	<!-- modal c√©lula (editar conte√∫do HTML/texto da c√©lula) -->
	<div
		id="modal"
		class="modal hidden"
		role="dialog"
		aria-modal="true"
	>
		<div class="modal-content">
			<div class="modal-header">
				<span data-i18n-text="modal.title">Editar c√©lula</span>
				<button
					id="modalClose"
					title="Fechar"
					data-i18n-title="buttons.close"
				>‚úï</button>
			</div>
			<textarea id="modalEditor" spellcheck="false"></textarea>
			<div class="modal-actions">
				<button id="modalCancel" data-i18n-text="modal.cancel">Cancelar</button>
				<button id="modalApply" data-i18n-text="modal.apply">Aplicar</button>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/turndown@7.1.1/dist/turndown.min.js"></script>
	<script src="app.js"></script>
	<script>
		// Aviso ao tentar sair da p√°gina
		window.addEventListener('beforeunload', function (e) {
			const message = 'Sair do site? √â poss√≠vel que altera√ß√µes feitas n√£o sejam salvas.';
			e.preventDefault();
			e.returnValue = message;
			return message;
		});

		// Carrega textos da interface a partir de JSON
		(async function loadTranslations() {
			try {
				const res = await fetch('i18n/pt-BR.json');
				if (!res.ok) return;
				const dict = await res.json();

				// Helper para acessar chaves aninhadas, ex: "explorer.title"
				const get = (obj, path) => path.split('.').reduce((o, k) => (o ? o[k] : undefined), obj);

				// data-i18n-text => textContent
				document.querySelectorAll('[data-i18n-text]').forEach(el => {
					const key = el.getAttribute('data-i18n-text');
					const v = get(dict, key);
					if (v != null) el.textContent = v;
				});

				// data-i18n-placeholder => placeholder
				document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
					const key = el.getAttribute('data-i18n-placeholder');
					const v = get(dict, key);
					if (v != null) el.setAttribute('placeholder', v);
				});

				// data-i18n-title => title
				document.querySelectorAll('[data-i18n-title]').forEach(el => {
					const key = el.getAttribute('data-i18n-title');
					const v = get(dict, key);
					if (v != null) el.setAttribute('title', v);
				});

				// data-i18n-aria-label => aria-label
				document.querySelectorAll('[data-i18n-aria-label]').forEach(el => {
					const key = el.getAttribute('data-i18n-aria-label');
					const v = get(dict, key);
					if (v != null) el.setAttribute('aria-label', v);
				});
			} catch (e) {
				// falha silenciosa se JSON n√£o estiver dispon√≠vel
				console.error('Falha ao carregar tradu√ß√µes', e);
			}
		})();
	</script>
</body>
</html>
``` 
