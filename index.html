<!doctype html>
<html lang="pt-BR">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title data-i18n-text="app.title">Source BR - HUB</title>
	<link rel="stylesheet" href="style.css" />
	<link rel="icon" type="image/png" href="icon.svg">
</head>
<body>
	<div id="app" class="theme-dark">
		<aside class="sidebar">
			<div class="logo">
				<img src="icon.svg" alt="Logo" style="height: 40px;">
			</div>
			<nav class="controls">
				<input id="folderInput" type="file" webkitdirectory directory multiple style="display:none" />
				<button id="openBtn" data-i18n-text="buttons.openFolder" title="Abrir pasta (Ctrl+O)">Abrir pasta</button>
				<button id="openGhBtn" title="Abrir repositÃ³rio GitHub" aria-label="Abrir GitHub">
					<svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
				</button>
				<button id="ghLoginBtn" title="Configurar Token GitHub (Acesso Privado)" aria-label="Login GitHub">ğŸ”‘</button>
				<button id="collapseBtn" data-i18n-text="buttons.collapseSidebar" title="Colapsar barra">â‡¤</button>
			</nav>
			<div class="explorer">
				<div class="explorer-title" data-i18n-text="explorer.title">Explorer</div>
				<div class="explorer-search">
					<input
						id="explorerSearch"
						type="search"
						placeholder="Pesquisar arquivos..."
						aria-label="Pesquisar arquivos"
						data-i18n-placeholder="explorer.searchPlaceholder"
						data-i18n-aria-label="explorer.searchAriaLabel"
					/>
				</div>
				<ul id="fileList">
					<li class="empty" data-i18n-text="explorer.empty">Nenhum arquivo</li>
				</ul>
			</div>
		</aside>

		<!-- resizer: arraste para redimensionar a sidebar -->
		<div id="sidebarResizer" class="sidebar-resizer" role="separator" aria-orientation="vertical" aria-label="Redimensionar barra"></div>

		<main class="main">
			<header class="editor-header">
				<div class="tabs"><span id="currentFilename">untitled.md</span></div>
				<div class="header-actions">
					<!-- indicador de conexÃ£o: clicÃ¡vel para tentar conectar/abrir seletor -->
						<div
							id="connStatus"
							class="conn-status"
							title="Status da conexÃ£o (clicar para conectar)"
							data-i18n-title="status.connectionTooltip"
						>
							<span class="dot"></span>
							<span class="label" data-i18n-text="status.disconnected">Desconectado</span>
						</div>
					<!-- botÃ£o reordenar linhas -->
					<button
						id="reorderBtn"
						title="Ativar reordenaÃ§Ã£o de linhas"
						data-i18n-title="buttons.reorder"
					>â‡…</button>
					<!-- botÃ£o Ã¡udio -->
					<button
						id="toggleAudioBtn"
						title="Ativar/Desativar Ã¡udios"
						data-i18n-title="buttons.toggleAudio"
					>ğŸ”Š</button>
					<!-- botÃ£o global para mostrar/ocultar editor bruto -->
					<button
						id="toggleRawBtn"
						title="Mostrar/Esconder editor bruto"
						data-i18n-title="buttons.toggleRaw"
					>ğŸ‘</button>
				</div>
			</header>

			<section class="preview-pane">
				<div
					id="preview"
					class="preview"
					title="Preview WYSIWYG â€” arraste arquivos da barra lateral para inserir"
					data-i18n-title="preview.title"
				></div>
			</section>
		</main>
	</div>

	<!-- save progress (top fixed) -->
	<div
		id="saveProgress"
		class="save-progress hidden"
		aria-hidden="true"
	>
		<div
			class="save-progress-bar"
			role="progressbar"
			aria-valuemin="0"
			aria-valuemax="100"
		></div>
		<div class="save-progress-text" data-i18n-text="saveProgress.text">Salvando...</div>
	</div>

	<!-- connect prompt (show when Ctrl+S but not connected) -->
	<div
		id="connectPrompt"
		class="connect-prompt hidden"
		role="dialog"
		aria-modal="true"
		aria-hidden="true"
	>
		<div class="connect-prompt-content">
			<div class="cp-title" data-i18n-text="connectPrompt.title">Servidor local nÃ£o conectado</div>
			<div class="cp-body" data-i18n-text="connectPrompt.body">
				Para salvar no disco local vocÃª precisa conectar ao servidor local. Deseja conectar agora?
			</div>
			<div class="cp-actions">
				<button id="cpConnectBtn" data-i18n-text="connectPrompt.connect">Conectar</button>
				<button id="cpCancelBtn" data-i18n-text="connectPrompt.cancel">Cancelar</button>
			</div>
		</div>
	</div>

	<!-- painel raw (overlay) -->
	<div
		id="rawPanel"
		class="raw-panel hidden"
		role="dialog"
		aria-modal="true"
	>
		<div class="raw-panel-content">
			<div class="raw-panel-header">
				<span data-i18n-text="rawPanel.title">Editor â€” texto bruto</span>
				<button
					id="rawClose"
					title="Fechar"
					data-i18n-title="buttons.close"
				>âœ•</button>
			</div>
			<textarea id="editor" spellcheck="false"></textarea>
			<div class="raw-panel-actions">
				<button id="rawCancel" data-i18n-text="rawPanel.cancel">Cancelar</button>
				<button id="rawCopy" title="Copiar tudo">Copiar</button>
				<button id="rawApply" data-i18n-text="rawPanel.apply">Aplicar</button>
			</div>
		</div>
	</div>

	<!-- modal cÃ©lula (editar conteÃºdo HTML/texto da cÃ©lula) -->
	<div
		id="modal"
		class="modal hidden"
		role="dialog"
		aria-modal="true"
	>
		<div class="modal-content">
			<div class="modal-header">
				<span data-i18n-text="modal.title">Editar cÃ©lula</span>
				<button
					id="modalClose"
					title="Fechar"
					data-i18n-title="buttons.close"
				>âœ•</button>
			</div>
			<textarea id="modalEditor" spellcheck="false"></textarea>
			<div class="modal-actions">
				<button id="modalCancel" data-i18n-text="modal.cancel">Cancelar</button>
				<button id="modalApply" data-i18n-text="modal.apply">Aplicar</button>
			</div>
		</div>
	</div>

	<!-- modal login github -->
	<div id="ghLoginModal" class="modal hidden" role="dialog" aria-modal="true">
		<div class="modal-content" style="max-width: 400px;">
			<div class="modal-header">
				<span>AutenticaÃ§Ã£o GitHub</span>
				<button id="ghLoginClose">âœ•</button>
			</div>
			<div style="padding: 12px 0; font-size: 13px; color: var(--muted);">
				<p>Para acessar repositÃ³rios privados, insira um <b>Personal Access Token (Classic)</b>.</p>
				<p style="font-size:11px; opacity:0.7;">PermissÃµes necessÃ¡rias: <code>repo</code></p>
				<input type="password" id="ghTokenInput" placeholder="ghp_..." style="width:100%; padding:8px; border-radius:6px; border:1px solid rgba(255,255,255,0.1); background:rgba(0,0,0,0.2); color:white; margin-top:8px;">
			</div>
			<div class="modal-actions">
				<button id="ghLogoutBtn" style="color:#ff6b6b; border-color:rgba(255,107,107,0.3); margin-right:auto; display:none;">Sair</button>
				<button id="ghLoginSave">Salvar Token</button>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/markdown-it@13.0.1/dist/markdown-it.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/turndown@7.1.1/dist/turndown.min.js"></script>
	<script src="app.js"></script>
	<script>
		// Aviso ao tentar sair da pÃ¡gina
		window.addEventListener('beforeunload', function (e) {
			const message = 'Sair do site? Ã‰ possÃ­vel que alteraÃ§Ãµes feitas nÃ£o sejam salvas.';
			e.preventDefault();
			e.returnValue = message;
			return message;
		});

		// Carrega textos da interface a partir de JSON
		(async function loadTranslations() {
			try {
				const res = await fetch('i18n/pt-BR.json');
				if (!res.ok) return;

				// Garante que o conteÃºdo seja JSON vÃ¡lido
				const text = await res.text();
				let dict;
				try {
					dict = JSON.parse(text);
				} catch (err) {
					console.error('pt-BR.json nÃ£o Ã© JSON vÃ¡lido:', err);
					return;
				}

				const get = (obj, path) => path.split('.').reduce((o, k) => (o ? o[k] : undefined), obj);

				// data-i18n-text => textContent
				document.querySelectorAll('[data-i18n-text]').forEach(el => {
					const key = el.getAttribute('data-i18n-text');
					const v = get(dict, key);
					if (v != null) el.textContent = v;
				});

				// data-i18n-placeholder => placeholder
				document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
					const key = el.getAttribute('data-i18n-placeholder');
					const v = get(dict, key);
					if (v != null) el.setAttribute('placeholder', v);
				});

				// data-i18n-title => title
				document.querySelectorAll('[data-i18n-title]').forEach(el => {
					const key = el.getAttribute('data-i18n-title');
					const v = get(dict, key);
					if (v != null) el.setAttribute('title', v);
				});

				// data-i18n-aria-label => aria-label
				document.querySelectorAll('[data-i18n-aria-label]').forEach(el => {
					const key = el.getAttribute('data-i18n-aria-label');
					const v = get(dict, key);
					if (v != null) el.setAttribute('aria-label', v);
				});
			} catch (e) {
				console.error('Falha ao carregar traduÃ§Ãµes', e);
			}
		})();
	</script>
</body>
</html>
